import{a as B,c as j,d as ye,e as we,f as S,g as _e,h as v,j as xe,k as Ie,l as T}from"./chunk-YOFEHJF6.js";import{a as b,b as Re,c as y,d as Fe,e as Pe,f as Se,g as Te,h as Ae,i as He,j as K,k as V}from"./chunk-M7VHFCY7.js";import{$ as D,A as _,Aa as Ce,B as x,Ba as be,Ea as Q,G as I,H as c,I as ae,J as g,K as R,L as z,M as N,N as se,P as F,Q as le,R as E,T as P,U as fe,V as ce,W as s,X as p,Y as C,Z as O,_ as m,a as Z,b as G,c as H,ca as ge,da as pe,ea as me,f as ie,fa as f,g as M,ga as Y,ha as ue,j as de,l as oe,la as J,p as u,r as l,ra as he,u as L,ua as De,v as h,w as k,wa as ve,ya as Ee}from"./chunk-O5ZHLN5W.js";var ze=["move","copy","link"],U="application/x-dnd",te="application/json",$="Text";function Ne(t){return t.substr(0,U.length)===U}function Oe(t){if(t.dataTransfer){let r=t.dataTransfer.types;if(!r)return $;for(let e=0;e<r.length;e++)if(r[e]===$||r[e]===te||Ne(r[e]))return r[e]}return null}function Ze(t,r,e){let n=U+(r.type?"-"+r.type:""),i=JSON.stringify(r);try{t.dataTransfer?.setData(n,i)}catch{try{t.dataTransfer?.setData(te,i)}catch{let w=q(ze,e);t.dataTransfer&&(t.dataTransfer.effectAllowed=w[0]),t.dataTransfer?.setData($,i)}}}function Ge(t,r){let e=Oe(t);return r===!0?e!==null&&Ne(e)?JSON.parse(t.dataTransfer?.getData(e)??"{}"):{}:e!==null?JSON.parse(t.dataTransfer?.getData(e)??"{}"):{}}function q(t,r){return r==="all"||r==="uninitialized"?t:t.filter(function(e){return r.toLowerCase().indexOf(e)!==-1})}function Ye(t,r){let e=r;for(;e.parentNode!==t;){if(!e.parentNode)return null;e=e.parentNode}return e}function Je(t,r,e){let n=r.getBoundingClientRect();return e?t.clientX<n.left+n.width/2:t.clientY<n.top+n.height/2}function Qe(t,r){let e=window.getComputedStyle(r),n=parseFloat(e.paddingTop)||0,i=parseFloat(e.paddingLeft)||0,d=parseFloat(e.borderTopWidth)||0,o=parseFloat(e.borderLeftWidth)||0;return{x:t.offsetX+i+o,y:t.offsetY+n+d}}function Ke(t,r,e){let n=e(t,r)||{x:0,y:0};t.dataTransfer.setDragImage(r,n.x,n.y)}var a={isDragging:!1,dropEffect:"none",effectAllowed:"all",type:void 0};function We(t,r,e){a.isDragging=!0,a.dropEffect="none",a.effectAllowed=r,a.type=e,t.dataTransfer&&(t.dataTransfer.effectAllowed=r)}function Me(){a.isDragging=!1,a.dropEffect=void 0,a.effectAllowed=void 0,a.type=void 0}function W(t,r){a.isDragging===!0&&(a.dropEffect=r),t.dataTransfer&&(t.dataTransfer.dropEffect=r)}function Le(t,r){let e=t.dataTransfer?t.dataTransfer.effectAllowed:"uninitialized",n=q(ze,e);return a.isDragging===!0&&(n=q(n,a.effectAllowed)),r&&(n=q(n,r)),n.length===0?"none":t.ctrlKey&&n.indexOf("copy")!==-1?"copy":t.altKey&&n.indexOf("link")!==-1?"link":n[0]}function X(t){if(a.isDragging===!0)return a.type;let r=Oe(t);if(r!==null&&!(r===$||r===te))return r.substr(U.length+1)||void 0}function ee(){return a.isDragging===!1}var ke=a;var Be=(()=>{class t{dndDraggable;dndEffectAllowed="copy";dndType;dndDraggingClass="dndDragging";dndDraggingSourceClass="dndDraggingSource";dndDraggableDisabledClass="dndDraggableDisabled";dndDragImageOffsetFunction=Qe;dndStart=new c;dndDrag=new c;dndEnd=new c;dndMoved=new c;dndCopied=new c;dndLinked=new c;dndCanceled=new c;draggable=!0;dndHandle;dndDragImageElementRef;dragImage;isDragStarted=!1;elementRef=l(I);renderer=l(z);ngZone=l(N);set dndDisableIf(e){this.draggable=!e,this.draggable?this.renderer.removeClass(this.elementRef.nativeElement,this.dndDraggableDisabledClass):this.renderer.addClass(this.elementRef.nativeElement,this.dndDraggableDisabledClass)}set dndDisableDragIf(e){this.dndDisableIf=e}ngAfterViewInit(){this.ngZone.runOutsideAngular(()=>{this.elementRef.nativeElement.addEventListener("drag",this.dragEventHandler)})}ngOnDestroy(){this.elementRef.nativeElement.removeEventListener("drag",this.dragEventHandler),this.isDragStarted&&Me()}onDragStart(e){if(!this.draggable)return!1;if(this.dndHandle!=null&&e._dndUsingHandle==null)return e.stopPropagation(),!1;We(e,this.dndEffectAllowed,this.dndType),this.isDragStarted=!0,Ze(e,{data:this.dndDraggable,type:this.dndType},ke.effectAllowed),this.dragImage=this.determineDragImage(),this.renderer.addClass(this.dragImage,this.dndDraggingClass),(this.dndDragImageElementRef!=null||e._dndUsingHandle!=null)&&Ke(e,this.dragImage,this.dndDragImageOffsetFunction);let n=this.renderer.listen(this.elementRef.nativeElement,"drag",()=>{this.renderer.addClass(this.elementRef.nativeElement,this.dndDraggingSourceClass),n()});return this.dndStart.emit(e),e.stopPropagation(),setTimeout(()=>{this.renderer.setStyle(this.dragImage,"pointer-events","none")},100),!0}onDrag(e){this.dndDrag.emit(e)}onDragEnd(e){if(!this.draggable||!this.isDragStarted)return;let n=ke.dropEffect;this.renderer.setStyle(this.dragImage,"pointer-events","unset");let i;switch(n){case"copy":i=this.dndCopied;break;case"link":i=this.dndLinked;break;case"move":i=this.dndMoved;break;default:i=this.dndCanceled;break}i.emit(e),this.dndEnd.emit(e),Me(),this.isDragStarted=!1,this.renderer.removeClass(this.dragImage,this.dndDraggingClass),window.setTimeout(()=>{this.renderer.removeClass(this.elementRef.nativeElement,this.dndDraggingSourceClass)},0),e.stopPropagation()}registerDragHandle(e){this.dndHandle=e}registerDragImage(e){this.dndDragImageElementRef=e}dragEventHandler=e=>this.onDrag(e);determineDragImage(){return typeof this.dndDragImageElementRef<"u"?this.dndDragImageElementRef.nativeElement:this.elementRef.nativeElement}static \u0275fac=function(n){return new(n||t)};static \u0275dir=k({type:t,selectors:[["","dndDraggable",""]],hostVars:1,hostBindings:function(n,i){n&1&&m("dragstart",function(o){return i.onDragStart(o)})("dragend",function(o){return i.onDragEnd(o)}),n&2&&le("draggable",i.draggable)},inputs:{dndDraggable:"dndDraggable",dndEffectAllowed:"dndEffectAllowed",dndType:"dndType",dndDraggingClass:"dndDraggingClass",dndDraggingSourceClass:"dndDraggingSourceClass",dndDraggableDisabledClass:"dndDraggableDisabledClass",dndDragImageOffsetFunction:"dndDragImageOffsetFunction",dndDisableIf:"dndDisableIf",dndDisableDragIf:"dndDisableDragIf"},outputs:{dndStart:"dndStart",dndDrag:"dndDrag",dndEnd:"dndEnd",dndMoved:"dndMoved",dndCopied:"dndCopied",dndLinked:"dndLinked",dndCanceled:"dndCanceled"},standalone:!0})}return t})(),ne=(()=>{class t{elementRef;constructor(e){this.elementRef=e}ngOnInit(){this.elementRef.nativeElement.style.pointerEvents="none"}static \u0275fac=function(n){return new(n||t)(R(I))};static \u0275dir=k({type:t,selectors:[["","dndPlaceholderRef",""]],standalone:!0})}return t})(),je=(()=>{class t{ngZone;elementRef;renderer;dndDropzone="";dndEffectAllowed="uninitialized";dndAllowExternal=!1;dndHorizontal=!1;dndDragoverClass="dndDragover";dndDropzoneDisabledClass="dndDropzoneDisabled";dndDragover=new c;dndDrop=new c;dndPlaceholderRef;placeholder=null;disabled=!1;constructor(e,n,i){this.ngZone=e,this.elementRef=n,this.renderer=i}set dndDisableIf(e){this.disabled=e,this.disabled?this.renderer.addClass(this.elementRef.nativeElement,this.dndDropzoneDisabledClass):this.renderer.removeClass(this.elementRef.nativeElement,this.dndDropzoneDisabledClass)}set dndDisableDropIf(e){this.dndDisableIf=e}ngAfterViewInit(){this.placeholder=this.tryGetPlaceholder(),this.removePlaceholderFromDOM(),this.ngZone.runOutsideAngular(()=>{this.elementRef.nativeElement.addEventListener("dragenter",this.dragEnterEventHandler),this.elementRef.nativeElement.addEventListener("dragover",this.dragOverEventHandler),this.elementRef.nativeElement.addEventListener("dragleave",this.dragLeaveEventHandler)})}ngOnDestroy(){this.elementRef.nativeElement.removeEventListener("dragenter",this.dragEnterEventHandler),this.elementRef.nativeElement.removeEventListener("dragover",this.dragOverEventHandler),this.elementRef.nativeElement.removeEventListener("dragleave",this.dragLeaveEventHandler)}onDragEnter(e){if(e._dndDropzoneActive===!0){this.cleanupDragoverState();return}if(e._dndDropzoneActive==null){let i=document.elementFromPoint(e.clientX,e.clientY);this.elementRef.nativeElement.contains(i)&&(e._dndDropzoneActive=!0)}let n=X(e);this.isDropAllowed(n)&&e.preventDefault()}onDragOver(e){if(e.defaultPrevented)return;let n=X(e);if(!this.isDropAllowed(n))return;this.checkAndUpdatePlaceholderPosition(e);let i=Le(e,this.dndEffectAllowed);if(i==="none"){this.cleanupDragoverState();return}e.preventDefault(),W(e,i),this.dndDragover.emit(e),this.renderer.addClass(this.elementRef.nativeElement,this.dndDragoverClass)}onDrop(e){try{let n=X(e);if(!this.isDropAllowed(n))return;let i=Ge(e,ee());if(!this.isDropAllowed(i.type))return;e.preventDefault();let d=Le(e);if(W(e,d),d==="none")return;let o=this.getPlaceholderIndex();if(o===-1)return;this.dndDrop.emit({event:e,dropEffect:d,isExternal:ee(),data:i.data,index:o,type:n}),e.stopPropagation()}finally{this.cleanupDragoverState()}}onDragLeave(e){if(e.preventDefault(),e.stopPropagation(),e._dndDropzoneActive==null&&this.elementRef.nativeElement.contains(e.relatedTarget)){e._dndDropzoneActive=!0;return}this.cleanupDragoverState(),W(e,"none")}dragEnterEventHandler=e=>this.onDragEnter(e);dragOverEventHandler=e=>this.onDragOver(e);dragLeaveEventHandler=e=>this.onDragLeave(e);isDropAllowed(e){if(this.disabled||ee()&&!this.dndAllowExternal)return!1;if(!this.dndDropzone||!e)return!0;if(!Array.isArray(this.dndDropzone))throw new Error("dndDropzone: bound value to [dndDropzone] must be an array!");return this.dndDropzone.indexOf(e)!==-1}tryGetPlaceholder(){return typeof this.dndPlaceholderRef<"u"?this.dndPlaceholderRef.elementRef.nativeElement:this.elementRef.nativeElement.querySelector("[dndPlaceholderRef]")}removePlaceholderFromDOM(){this.placeholder!==null&&this.placeholder.parentNode!==null&&this.placeholder.parentNode.removeChild(this.placeholder)}checkAndUpdatePlaceholderPosition(e){if(this.placeholder===null)return;this.placeholder.parentNode!==this.elementRef.nativeElement&&this.renderer.appendChild(this.elementRef.nativeElement,this.placeholder);let n=Ye(this.elementRef.nativeElement,e.target);if(n===null||n===this.placeholder)return;Je(e,n,this.dndHorizontal)?n.previousSibling!==this.placeholder&&this.renderer.insertBefore(this.elementRef.nativeElement,this.placeholder,n):n.nextSibling!==this.placeholder&&this.renderer.insertBefore(this.elementRef.nativeElement,this.placeholder,n.nextSibling)}getPlaceholderIndex(){if(this.placeholder===null)return;let e=this.elementRef.nativeElement;return Array.prototype.indexOf.call(e.children,this.placeholder)}cleanupDragoverState(){this.renderer.removeClass(this.elementRef.nativeElement,this.dndDragoverClass),this.removePlaceholderFromDOM()}static \u0275fac=function(n){return new(n||t)(R(N),R(I),R(z))};static \u0275dir=k({type:t,selectors:[["","dndDropzone",""]],contentQueries:function(n,i,d){if(n&1&&ge(d,ne,5),n&2){let o;pe(o=me())&&(i.dndPlaceholderRef=o.first)}},hostBindings:function(n,i){n&1&&m("drop",function(o){return i.onDrop(o)})},inputs:{dndDropzone:"dndDropzone",dndEffectAllowed:"dndEffectAllowed",dndAllowExternal:"dndAllowExternal",dndHorizontal:"dndHorizontal",dndDragoverClass:"dndDragoverClass",dndDropzoneDisabledClass:"dndDropzoneDisabledClass",dndDisableIf:"dndDisableIf",dndDisableDropIf:"dndDisableDropIf"},outputs:{dndDragover:"dndDragover",dndDrop:"dndDrop"},standalone:!0})}return t})();var Ve=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=h({type:t});static \u0275inj=u({})}return t})();var tt=(t,r)=>r.id,nt=t=>["/pages/edit",t],rt=t=>({backgroundColor:t});function it(t,r){if(t&1){let e=O();s(0,"a",6),m("dndEnd",function(i){_(e);let d=D();return x(d.onDragEnd(i))}),s(1,"h2",7),f(2),p(),s(3,"p",8),f(4),p(),C(5,"div",9),s(6,"app-button",10),m("click",function(i){let d=_(e).$implicit,o=D();return x(o.deletePage(i,d.id))}),f(7,"Delete"),p()()}if(t&2){let e=r.$implicit;E("routerLink",J(6,nt,e.id))("dndDraggable",e)("dndEffectAllowed","copyMove"),g(2),Y(e.title),g(2),Y(e.description),g(),E("ngStyle",J(8,rt,e.color))}}var qe=(()=>{let r=class r{onDragEnd(n){console.log("drag ended",JSON.stringify(n,null,2))}onDrop(n){return H(this,null,function*(){let i=n.data,d=this.pagesList()[n.index];d||(d=this.pagesList()[this.pagesList().length-1]),d.order=i.order,i.order=n.index+1;let o=v(this.firestore,`pages/${i.id}`);yield T(o,{order:i.order});let w=v(this.firestore,`pages/${d.id}`);yield T(w,{order:d.order})})}constructor(){this.pagesList=se([]),this.firestore=l(B);let n=S(this.firestore,"pages"),i=Ie(n,xe("order"));j(i,{idField:"id"}).pipe(M(d=>d),oe(d=>this.pagesList.set(d))).subscribe()}deletePage(n,i){n.preventDefault(),n.stopPropagation();let d=v(this.firestore,`pages/${i}`);_e(d)}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=L({type:r,selectors:[["app-list"]],decls:9,vars:0,consts:[[1,"flex","items-center","justify-between","mb-10"],[1,"text-3xl"],["routerLink","/pages/add"],["dndDropzone","",1,"grid","grid-cols-1","gap-5",3,"dndDrop"],[1,"block","bg-white","shadow-md","rounded-lg","p-5","min-w-[200px]",3,"routerLink","dndDraggable","dndEffectAllowed"],["dndPlaceholderRef","",2,"border","1px #ddd dashed","border-radius","5px","padding","15px","min-height","100px"],[1,"block","bg-white","shadow-md","rounded-lg","p-5","min-w-[200px]",3,"dndEnd","routerLink","dndDraggable","dndEffectAllowed"],[1,"text-xl"],[1,"text-slate-500"],[1,"w-[100px]","h-[20px]","mt-5",3,"ngStyle"],["color","danger",1,"mt-10","block",3,"click"]],template:function(i,d){i&1&&(s(0,"div",0)(1,"h1",1),f(2,"Pages"),p(),s(3,"app-button",2),f(4,"Add New Page"),p()(),s(5,"div",3),m("dndDrop",function(w){return d.onDrop(w)}),fe(6,it,8,10,"a",4,tt),C(8,"div",5),p()),i&2&&(g(6),ce(d.pagesList()))},dependencies:[De,be,b,Be,je,ne]});let t=r;return t})();function dt(t,r){if(t&1&&f(0),t&2){let e,n=D();ue(" Edit ",(e=n.page())==null?null:e.title," ")}}function ot(t,r){t&1&&f(0," Add New Page ")}function at(t,r){if(t&1&&C(0,"img",3),t&2){let e,n=D(2);E("src",n.pageForm.value.bgPatternImg||((e=n.page())==null?null:e.bgPatternImg),ae)}}function st(t,r){t&1&&f(0," Save ")}function lt(t,r){t&1&&f(0," Add ")}function ft(t,r){if(t&1){let e=O();s(0,"form",2),F(1,at,1,1,"img",3),C(2,"app-input-field",4)(3,"app-input-field",5)(4,"app-input-field",6)(5,"app-input-field",7)(6,"app-input-field",8),s(7,"app-button",9),m("click",function(){_(e);let i=D();return x(i.submit())}),F(8,st,1,0)(9,lt,1,0),p()()}if(t&2){let e,n=D();E("formGroup",n.pageForm),g(),P(1,n.pageForm.value.bgPatternImg||(e=n.page())!=null&&e.bgPatternImg?1:-1),g(7),P(8,n.page()?8:9)}}var re=(()=>{let r=class r{constructor(){this.route=l(Ee),this.fb=l(He),this.firestore=l(B),this.router=l(Ce),this.page=Re(this.route.params.pipe(de(n=>{this.pageId=n.id;let i=v(this.firestore,`pages/${n.id}`);return ye(i)}))),he(()=>{if(this.page()){this.initForm();return}this.initForm(),this.formReady=!0})}initForm(){let n,i,d,o;this.page&&(this.page()?.bgPatternImg&&typeof this.page()?.bgPatternImg=="string"?this.hasFile=!1:this.hasFile=!0,n=this.page()?.title,i=this.page()?.description,d=this.page()?.color,o=this.page()?.darkerColor),this.pageForm=this.fb.group({bgPatternImg:["",y.required],title:[n,y.required],description:[i,y.required],color:[d,y.required],darkerColor:[o,y.required]})}submit(){return H(this,null,function*(){if(this.page()){let n=v(this.firestore,`pages/${this.pageId}`),i=G(Z({},this.pageForm.value),{bgPatternImg:this.pageForm.value.bgPatternImg?this.pageForm.value.bgPatternImg:this.page()?.bgPatternImg});yield T(n,i),this.router.navigateByUrl("/pages")}else{let n=S(this.firestore,"pages"),i=yield ie(j(n).pipe(M(d=>d.length)));yield we(S(this.firestore,"pages"),G(Z({},this.pageForm.value),{order:i+1})),this.router.navigateByUrl("/pages")}})}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=L({type:r,selectors:[["app-page-form"]],decls:5,vars:2,consts:[[1,"flex","items-center","justify-between","mb-10"],[1,"text-3xl"],[1,"flex","flex-col","gap-5",3,"formGroup"],["alt","",1,"h-[200px]","object-contain",3,"src"],["formControlName","bgPatternImg","type","file"],["formControlName","title","placeholder","Enter Page Title"],["formControlName","description","type","textarea","placeholder","Enter Page Description"],["formControlName","color","placeholder","Enter Primary Color"],["formControlName","darkerColor","placeholder","Enter Secondary Color"],[3,"click"]],template:function(i,d){i&1&&(s(0,"div",0)(1,"h1",1),F(2,dt,1,1)(3,ot,1,0),p()(),F(4,ft,10,3,"form",2)),i&2&&(g(2),P(2,d.page()?2:3),g(2),P(4,d.formReady?4:-1))},dependencies:[Se,Fe,Pe,Te,Ae,b,V]});let t=r;return t})();var ct=[{path:"",component:qe},{path:"add",component:re},{path:"edit/:id",component:re}],Ue=(()=>{let r=class r{};r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=h({type:r}),r.\u0275inj=u({imports:[Q.forChild(ct),Q]});let t=r;return t})();var gt=[K],$e=(()=>{let r=class r{};r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=h({type:r}),r.\u0275inj=u({imports:[gt,K]});let t=r;return t})();var rn=(()=>{let r=class r{};r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=h({type:r}),r.\u0275inj=u({imports:[ve,Ue,$e,b,V,Ve]});let t=r;return t})();export{rn as PagesModule};
